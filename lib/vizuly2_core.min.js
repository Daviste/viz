/*! Vizuly2 24-10-2018 */
(function (global, factory) {  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :  typeof define === 'function' && define.amd ? define(['exports'], factory) : 	(factory((global.vizuly2 = global.vizuly2 || {})));  } (this, (function (exports) { 'use strict';
var vizuly2={};vizuly2.d3=window.d3v4||d3||window.d3,vizuly2.d3?Number(vizuly2.d3.version.substr(0,1))<4&&console.log("WARNING - Your D3 Library v"+vizuly2.d3.version+" is not compatible with this version of Vizuly.   Please use D3 v4.0.0 or higher."):console.log("WARNING - No D3 library found for vizuly2!  Please load D3 library first."),vizuly2.core={},vizuly2.viz={},vizuly2.viz.layout={},vizuly2.viz.layout.CLUSTERED="CLUSTERED",vizuly2.viz.layout.STACKED="STACKED",vizuly2.viz.layout.OVERLAP="OVERLAP",vizuly2.viz.layout.STREAM="STREAM",vizuly2.svg={},vizuly2.ui={},vizuly2.assets={},vizuly2.core.component=function(t,p){var r,n,a=50;"string"==typeof t&&(t=d3.select(t).node()),p.parent=t,p.id=vizuly2.core.util.guid(),p.selection=vizuly2.d3.select(t).append("div").attr("id","div_"+p.id).style("width","100%").style("height","100%"),p.initialized=!1;p.styles;var i={},o=["initialized","validated","measured","updated","styled"];function l(){null==r&&(n=n||p.selection.node().getBoundingClientRect(),r=setTimeout(function(){var t=p.selection.node().getBoundingClientRect();if(u.update&&(t.width!=n.width||t.height!=n.height))if(u.duration){var e=u.duration();u.duration(0).update().duration(e)}else u.update();n=t,r=null},a))}Object.getOwnPropertyNames(p.properties).forEach(function(t,e,r){o.push(t+"_change")}),p.events&&0<p.events.length&&p.events.forEach(function(t){o.push(t)}),p.dispatch=vizuly2.d3.dispatch.apply(this,o);var u=function(){var n,a,i;return n=u,i=(a=p).properties,Object.getOwnPropertyNames(i).forEach(function(r,t,e){void 0===a[r]&&(a[r]=i[r],n[r]=function(t){if(!arguments.length)return a[r];var e=a[r];return a[r]=t,a[r]!==e&&a.dispatch.apply(r+"_change",this,[a[r],e]),n})}),u};return p.dispatch.component=u(),u.id=function(){return p.id},u.selection=function(){return p.selection},u.style=function(t,e){return arguments.length<2?i[t]?i[t]:p.styles[t]?p.styles[t]:null:(i[t]=e,u)},u.applyStyles=function(e){return Object.keys(e).forEach(function(t){u.style(t,e[t])}),u},u.clearStyles=function(){return Object.keys(styles).forEach(function(t){u.style(t,null)}),u},u.getStyle=function(t,e){return null!=i[t]?"function"==typeof i[t]?i[t].apply(u,e):i[t]:null!=p.styles[t]?"function"==typeof p.styles[t]?p.styles[t].apply(u,e):p.styles[t]:null},u.on=function(t,e){return p.dispatch.on(t,e),u},u.onChange=function(t,e){var r=t.split("."),n=r[0]+"_change"+(1<r.length?"."+r[1]:"");return p.dispatch.on(n,e),u},u.validate=function(){if(0==p.initialized&&p.initialize&&(p.initialize(),p.initialized=!0),!e){var e=[];if(Object.getOwnPropertyNames(p.properties).forEach(function(t){!p[t]&&Number(0!=p[t])&&e.push(t)}),0<e.length)throw new Error("vizuly2.core.util.component.validate(): "+e.concat()+" need to be declared");p.dispatch.apply("validated",this)}},u.applyCallbacks=function(t){t.forEach(function(t){p.dispatch.on(t.on,t.callback)})},u.showDataTip=function(t,e,r,n){if(p.dataTipRenderer&&null!=p.dataTipRenderer){var a,i,o=t.getBoundingClientRect(),l=vizuly2.d3.select("body").append("div").attr("class","vz-data-tip").style("display","none"),u=o.left,c=o.top+window.pageYOffset,s=p.dataTipRenderer(l,t,e,r,u,c);if(0!=s){s&&"object"==typeof s&&s.constructor===Array&&(u=s[0],c=s[1]);var d=l.nodes()[0].getBoundingClientRect();a=d.width,i=d.height,l.style("left",u?u+"px":o.left+o.width/2-a/2+"px").style("top",c?c+"px":o.top+window.pageYOffset-i-10+"px"),l.style("display","block")}}},u.removeDataTip=function(){vizuly2.d3.select(".vz-data-tip").remove()},u.parent=function(){return p.parent},u.size=function(){return p.size},u.updateOnResize=function(t,e){!0===t?(d3.select(window).on("resize.component_"+p.id,l),e&&(a=e)):(d3.select(window).on("resize.component_"+p.id,null),a=50)},u.destroy=function(){p.selection.remove(),p.selection=null,o.forEach(function(t){p.dispatch.on(t,null)}),p.dispatch=null,p=null},p.dispatch.component},vizuly2.core.util={},vizuly2.core.util.getRelativeWidth=function(t,e){if("string"==typeof t&&"%"==t.substr(t.length-1)){var r=Math.min(Number(t.substr(0,t.length-1)),100)/100;return Math.round(e.getBoundingClientRect().width*r)}return Number(t)},vizuly2.core.util.getRelativeHeight=function(t,e){if("string"==typeof t&&"%"==t.substr(t.length-1)){var r=Math.min(Number(t.substr(0,t.length-1)),100)/100;return Math.round(e.getBoundingClientRect().height*r)}return Number(t)},vizuly2.core.util.size=function(t,e,r,n){var a={};return n&&(e=vizuly2.core.util.getRelativeWidth(e,n),r=vizuly2.core.util.getRelativeHeight(r,n)),a.measuredWidth=e,a.measuredHeight=r,a.width=e-vizuly2.core.util.measure(t.left,e)-vizuly2.core.util.measure(t.right,e),a.height=r-vizuly2.core.util.measure(t.top,r)-vizuly2.core.util.measure(t.bottom,r),a.top=vizuly2.core.util.measure(t.top,r),a.left=vizuly2.core.util.measure(t.left,e),a.bottom=vizuly2.core.util.measure(t.bottom,r),a.right=vizuly2.core.util.measure(t.right,e),a},vizuly2.core.util.getTypedScale=function(t){return"string"==typeof t?vizuly2.d3.scaleBand():t instanceof Date?vizuly2.d3.scaleTime():vizuly2.d3.scaleLinear()},vizuly2.core.util.measure=function(t,e){if("string"==typeof t&&"%"==t.substr(t.length-1)){var r=Math.min(Number(t.substr(0,t.length-1)),100)/100;return Math.round(e*r)}return Number(t)},vizuly2.core.util.guid=function(){return"vzxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},vizuly2.core.util.getDefs=function(t){var e=t.selection().selectAll("svg defs");return e.nodes()&&e.nodes().length<1&&(e=t.selection().select("svg").append("defs")),e},vizuly2.core.util.createCSSKey=function(t){return"css"+vizuly2.core.util.cleanString(t)},vizuly2.core.util.cleanString=function(t){var e=String(t).replace(",","_");return e=(e=e.replace(/[\s+,'+,\.,\(,\),\',\&,\/]/g,"")).toUpperCase()},vizuly2.core.util.aggregateNest=function(t,u,c){for(var e=t[0];e.values;)e=e.values[0];var a=[];function s(t,e){if(e)for(var r=0;r<a.length;r++){var n=a[r];null!=t[n]&&(t["childProp_"+n]=t[n]),e["childProp_"+n]=t["childProp_"+n]?t["childProp_"+n]:t[n]}}Object.getOwnPropertyNames(e).forEach(function(t){a.push(t)}),function t(e,r){for(var n=0;n<e.length;n++){var a=e[n];if(a.values){t(a.values,a);for(var i=0;i<a.values.length;i++)for(var o=a.values[i],l=0;l<u.length;l++)isNaN(a["agg_"+u[l]])&&(a["agg_"+u[l]]=0),a["agg_"+u[l]]=c(a["agg_"+u[l]],o["agg_"+u[l]])}else for(var l=0;l<u.length;l++)a["agg_"+u[l]]=Number(a[u[l]]),isNaN(a["agg_"+u[l]])&&(a["agg_"+u[l]]=0);s(a,r)}}(t)},vizuly2.core.util.format_YEAR_Mon_MonDay=function(t){var e=vizuly2.d3.timeFormat(".%L"),r=vizuly2.d3.timeFormat(":%S"),n=vizuly2.d3.timeFormat("%I:%M"),a=vizuly2.d3.timeFormat("%I %p"),i=vizuly2.d3.timeFormat("%a %d"),o=vizuly2.d3.timeFormat("%b %d"),l=vizuly2.d3.timeFormat("%b"),u=vizuly2.d3.timeFormat("%Y");return(vizuly2.d3.timeSecond(t)<t?e:vizuly2.d3.timeMinute(t)<t?r:vizuly2.d3.timeHour(t)<t?n:vizuly2.d3.timeDay(t)<t?a:vizuly2.d3.timeMonth(t)<t?vizuly2.d3.timeWeek(t)<t?i:o:vizuly2.d3.timeYear(t)<t?l:u)(t)},vizuly2.core.util.stackOffsetBaseline=function(t,e){if(1<(r=t.length)){var r,n=1,a=t[e[0]];for(a.length;n<r;++n)a=t[e[n]]}},vizuly2.core.util.rgbToHex=function(t){var e=String(t).match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},vizuly2.core.util.transitionOnEnd=function(t,e){var r=0;t.on("start",function(){r++}).on("end",function(){0==--r&&e()})},vizuly2.core.util.colorBrightness=function(t){return(299*t.r+587*t.g+114*t.b)/1e3},vizuly2.svg.filter={},vizuly2.svg.filter.dropShadow=function(t,e,r,n){var a=Math.round(100*e)+"_"+Math.round(100*r)+"_"+Math.round(100*n),i=t.id(),o=vizuly2.core.util.getDefs(t).selectAll("#vz_filter_"+i+"_"+a).data([a]).enter().append("filter").attr("id","vz_filter_"+i+"_"+a).attr("class","vz-svg-filter-dropShadow").attr("width","300%").attr("height","300%");o.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",n),o.append("feOffset").attr("dx",e).attr("dy",r),o.append("feComponentTransfer").append("feFuncA").attr("type","linear").attr("slope",.2);var l=o.append("feMerge");return l.append("feMergeNode"),l.append("feMergeNode").attr("in","SourceGraphic"),"#vz_filter_"+i+"_"+a},vizuly2.svg.gradient={},vizuly2.svg.gradient.blend=function(t,e,r,n){var a,i,o,l,u=String(e).replace("#","")+String(r).replace("#",""),c="vz_gradient_blend_"+t.id()+"_"+u;"horizontal"==n?(a="100%",l=o=i="0%"):(o="100%",l=i=a="0%");var s=vizuly2.core.util.getDefs(t),d=s.selectAll("#"+c).data([u]);return(d=d.enter().append("linearGradient").attr("id",c).attr("class","vz-svg-gradient-blend").attr("x1",a).attr("x2",i).attr("y1",o).attr("y2",l)).append("stop").attr("offset","0%").attr("stop-color",e),d.append("stop").attr("offset","100%").attr("stop-color",r),d=s.selectAll("#"+c)},vizuly2.svg.gradient.radialBlend=function(t,e,r,n,a,i,o,l,u){var c=String(n).replace("#","")+String(a).replace("#","")+String(i).replace("%","")+String(o).replace("%",""),s="vz_gradient_radial_blend_"+t.id()+"_"+c,d=vizuly2.core.util.getDefs(t),p=d.selectAll("#"+s).data([c]);return(p=p.enter().append("radialGradient").attr("id",s).attr("class","vz-svg-gradient-radial-blend").attr("cx",e).attr("cy",r)).append("stop").attr("offset",i).attr("stop-color",n).attr("stop-opacity",void 0===l?1:l),p.append("stop").attr("offset",o).attr("stop-color",a).attr("stop-opacity",void 0===u?1:u),p=d.selectAll("#"+s)},vizuly2.svg.gradient.fade=function(t,e,r,n,a){a||(a=[0,1]),n||(n=[.75,.9]);var i,o,l,u,c=String(e).replace("#",""),s="vz_gradient_fade_"+t.id()+"_"+c;"horizontal"==r?(o="100%",u=l=i="0%"):(l="100%",u=o=i="0%");var d=vizuly2.core.util.getDefs(t),p=d.selectAll("#"+s).data([c]).enter().append("linearGradient").attr("id",s).attr("class","vz-svg-gradient-fade").attr("x1",i).attr("x2",o).attr("y1",l).attr("y2",u);return p.append("stop").attr("offset",100*a[0]+"%").attr("stop-color",e).attr("stop-opacity",n[0]),p.append("stop").attr("offset",100*a[1]+"%").attr("stop-color",e).attr("stop-opacity",n[1]),p=d.selectAll("#"+s)},vizuly2.svg.gradient.radialFade=function(t,e,r,n){n||(n=[0,1]),r||(r=[.75,.9]);var a=String(e).replace("#",""),i="vz_gradient_radial_fade"+t.id()+"_"+a,o=vizuly2.core.util.getDefs(t),l=o.selectAll("#"+i).data([a]).enter().append("radialGradient").attr("id",i).attr("class","vz-svg-gradient-radial-fade");return l.append("stop").attr("offset",100*n[0]+"%").attr("stop-color",e).attr("stop-opacity",r[0]),l.append("stop").attr("offset",100*n[1]+"%").attr("stop-color",e).attr("stop-opacity",r[1]),l=o.selectAll("#"+i)},vizuly2.svg.gradient.darker=function(t,e,r){var n,a,i,o,l=String(e).replace("#",""),u="vz_gradient_darker_"+t.id()+"_"+l;"horizontal"==r?(n="100%",o=i=a="0%"):(i="100%",o=a=n="0%");var c=vizuly2.core.util.getDefs(t),s=c.selectAll("#"+u).data([l]).enter().append("linearGradient").attr("class","vz-gradient-darker").attr("id",u).attr("x1",n).attr("x2",a).attr("y1",i).attr("y2",o);return s.append("stop").attr("offset","0%").attr("stop-color",e).attr("stop-opacity",.75),s.append("stop").attr("offset","100%").attr("stop-color",vizuly2.d3.rgb(e).darker()).attr("stop-opacity",.9),s=c.selectAll("#"+u)},vizuly2.svg.text={},vizuly2.svg.text.textArcPath=function(t,e){var r={};r.angle=e,r.startAngle=r.angle-179*.0174533,r.endAngle=r.angle+179*.0174533;var n=d3.arc().innerRadius(t).outerRadius(t)(r),a=/[Mm][\d\.\-e,\s]+[Aa][\d\.\-e,\s]+/.exec(n);return a&&(a=a[0]),a},vizuly2.svg.text.wrap=function(t,c,s,d){var p=t.attr("x"),e=t.attr("y");p=!p||isNaN(p)?0:p,e=!e||isNaN(e)?0:e;var f=d/3;t.each(function(){var t,e=d3.select(this),r=c.split(/\s+/).reverse(),n=[],a=0,i=d,o=e.attr("y"),l=1.1*parseFloat(d/2)+f;isNaN(l)&&(l=0);for(var u=e.text(null).append("tspan").attr("x",p).attr("y",o).attr("y",l).style("font-size",d+"px");t=r.pop();)n.push(t),u.text(n.join(" ")),u.node().getComputedTextLength()>s&&(n.pop(),u.text(n.join(" ")),n=[t],u=e.append("tspan").attr("x",p).attr("y",++a*i+l+o).text(t).style("font-size",d+"px"))})};var a={};function i(e,r,n){return function(){var t=n.apply(r,arguments);return t===r?e:t}}function p(t,e){for(var r=[t],n=[];null!=(t=r.pop());)if(n.push(t),(i=t.children)&&(a=i.length))for(var a,i,o=-1;++o<a;)r.push(i[o]);for(;null!=(t=n.pop());)e(t)}function t(t){return t.children}function e(t){return t.value}function r(t,e){return e.value-t.value}function n(t){return a.merge(t.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function o(t,e){return t.value-e.value}function x(t,e){var r=t._pack_next;(t._pack_next=e)._pack_prev=t,(e._pack_next=r)._pack_prev=e}function b(t,e){(t._pack_next=e)._pack_prev=t}function z(t,e){var r=e.x-t.x,n=e.y-t.y,a=t.r+e.r;return r*r+n*n<.999*a*a}function f(t){if((e=t.children)&&(u=e.length)){var e,r,n,a,i,o,l,u,c=1/0,s=-1/0,d=1/0,p=-1/0;if(e.forEach(M),(r=e[0]).x=-r.r,r.y=0,m(r),1<u&&((n=e[1]).x=n.r,n.y=0,m(n),2<u))for(k(r,n,a=e[2]),m(a),x(r,a),x(r._pack_prev=a,n),n=r._pack_next,i=3;i<u;i++){k(r,n,a=e[i]);var f=0,g=1,v=1;for(o=n._pack_next;o!==n;o=o._pack_next,g++)if(z(o,a)){f=1;break}if(1==f)for(l=r._pack_prev;l!==o._pack_prev&&!z(l,a);l=l._pack_prev,v++);f?(g<v||g==v&&n.r<r.r?b(r,n=o):b(r=l,n),i--):(x(r,a),m(n=a))}var h=(c+s)/2,y=(d+p)/2,_=0;for(i=0;i<u;i++)(a=e[i]).x-=h,a.y-=y,_=Math.max(_,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=_,e.forEach(S)}function m(t){c=Math.min(t.x-t.r,c),s=Math.max(t.x+t.r,s),d=Math.min(t.y-t.r,d),p=Math.max(t.y+t.r,p)}}function M(t){t._pack_next=t._pack_prev=t}function S(t){delete t._pack_next,delete t._pack_prev}function k(t,e,r){var n=t.r+r.r,a=e.x-t.x,i=e.y-t.y;if(n&&(a||i)){var o=e.r+r.r,l=a*a+i*i,u=.5+((n*=n)-(o*=o))/(2*l),c=Math.sqrt(Math.max(0,2*o*(n+l)-(n-=l)*n-o*o))/(2*l);r.x=t.x+u*a+c*i,r.y=t.y+u*i-c*a}else r.x=t.x+n,r.y=t.y}a.layout={},a.svg={},a.functor=function(t){return"function"==typeof t?t:function(){return t}},a.merge=function(t){for(var e,r,n,a=t.length,i=-1,o=0;++i<a;)o+=t[i].length;for(r=new Array(o);0<=--a;)for(e=(n=t[a]).length;0<=--e;)r[--o]=n[e];return r},a.rebind=function(t,e){for(var r,n=1,a=arguments.length;++n<a;)t[r=arguments[n]]=i(t,e,e[r]);return t},a.layout.hierarchy=function(){var l=r,u=t,c=e;function s(t){var e,r=[t],n=[];for(t.depth=0;null!=(e=r.pop());)if(n.push(e),(i=u.call(s,e,e.depth))&&(a=i.length)){for(var a,i,o;0<=--a;)r.push(o=i[a]),o.parent=e,o.depth=e.depth+1;c&&(e.value=0),e.children=i}else c&&(e.value=+c.call(s,e,e.depth)||0),delete e.children;return p(t,function(t){var e,r;l&&(e=t.children)&&e.sort(l),c&&(r=t.parent)&&(r.value+=t.value)}),n}return s.sort=function(t){return arguments.length?(l=t,s):l},s.children=function(t){return arguments.length?(u=t,s):u},s.value=function(t){return arguments.length?(c=t,s):c},s.revalue=function(t){return c&&(!function(t,e){var r=[t];for(;null!=(t=r.pop());)if(e(t),(a=t.children)&&(n=a.length))for(var n,a;0<=--n;)r.push(a[n])}(t,function(t){t.children&&(t.value=0)}),p(t,function(t){var e;t.children||(t.value=+c.call(s,t,t.depth)||0),(e=t.parent)&&(e.value+=t.value)})),t},s},a.layout.pack=function(){var u,t,e,c=a.layout.hierarchy().sort(o),s=0,d=[1,1];function r(t,e){var r=c.call(this,t,e),n=r[0],a=d[0],i=d[1],o=null==u?Math.sqrt:"function"==typeof u?u:function(){return u};if(n.x=n.y=0,p(n,function(t){t.r=+o(t.value)}),p(n,f),s){var l=s*(u?1:Math.max(2*n.r/a,2*n.r/i))/2;p(n,function(t){t.r+=l}),p(n,f),p(n,function(t){t.r-=l})}return function t(e,r,n,a){var i=e.children;e.x=r+=a*e.x;e.y=n+=a*e.y;e.r*=a;if(i)for(var o=-1,l=i.length;++o<l;)t(i[o],r,n,a)}(n,a/2,i/2,u?1:1/Math.max(2*n.r/a,2*n.r/i)),r}return r.size=function(t){return arguments.length?(d=t,r):d},r.radius=function(t){return arguments.length?(u=null==t||"function"==typeof t?t:+t,r):u},r.padding=function(t){return arguments.length?(s=+t,r):s},t=r,e=c,a.rebind(t,e,"sort","children","value"),(t.nodes=t).links=n,t},a.svg.diagonal=function(){var o=function(t){return t.source},l=function(t){return t.target},u=function(t){return[t.x,t.y]};function e(t,e){var r=o.call(this,t,e),n=l.call(this,t,e),a=(r.y+n.y)/2,i=[r,{x:r.x,y:a},{x:n.x,y:a},n];return"M"+(i=i.map(u))[0]+"C"+i[1]+" "+i[2]+" "+i[3]}return e.source=function(t){return arguments.length?(o=a.functor(t),e):o},e.target=function(t){return arguments.length?(l=a.functor(t),e):l},e.projection=function(t){return arguments.length?(u=t,e):u},e},a.svg.diagonal.radial=function(){var t=a.svg.diagonal(),n=function(t){return[t.x,t.y]},e=t.projection;return t.projection=function(t){return arguments.length?e(function(t){return n=t,function(){var t=n.apply(this,arguments),e=t[0],r=t[1]-halfπ;return[e*Math.cos(r),e*Math.sin(r)]}}):n},t},vizuly2.d3v3=a;
 Object.keys(vizuly2).forEach(function (key) { exports[key] = vizuly2[key]});
 Object.defineProperty(exports, '__esModule', { value: true });})));